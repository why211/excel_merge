# Excel数据处理工具同步功能开发需求

## 任务描述
为现有的Excel文件处理工具添加数据同步功能，支持两种操作模式：
1. 合并到空Excel（已实现）
2. 同步到有数据的Excel（新增需求）

## 核心需求

### 1. 功能模式选择
在程序开始时提供两种操作模式选择：
- **模式1**：合并到空Excel（现有功能）
- **模式2**：同步到有数据的Excel（新增功能）

### 2. 同步模式功能要求

#### 2.1 源文件和目标文件选择
- 允许用户选择源Excel文件（包含完整学号和姓名信息）
- 允许用户选择目标Excel文件（包含学号但缺少学生姓名）
- 支持多个源文件，系统自动合并映射关系
- 支持多个目标文件，批量同步更新

#### 2.2 关联字段配置
- 默认使用"学号"作为关联字段
- 支持自定义关联字段名称
- 支持多种学号字段格式（如"学号"、"*学号"等）
- 支持多种学生姓名字段格式（如"学生姓名"、"*学生姓名"等）

#### 2.3 同步策略
- **精确匹配**：学号完全一致时进行同步
- **模糊匹配**：支持一位字符差异的学号匹配（容错处理）
- **更新策略**：只更新目标文件中学生姓名为空的记录
- **保留策略**：目标文件中已有学生姓名的记录保持不变

#### 2.4 冲突处理
- 当源文件中有重复学号时，优先使用第一个匹配的姓名
- 当目标文件中学号不存在于源文件时，可选择使用默认值或保持原状
- 提供详细的冲突处理报告

## 技术实现要求

### 1. 用户界面设计

#### 1.1 模式选择界面
=== Excel文件处理工具 v2.2 ===
�� 功能：多文件数据合并、字段选择、去重处理、学生姓名补充、数据同步
请选择操作模式：
合并到空Excel（创建新的合并文件）
同步到有数据的Excel（更新现有文件）
请选择 (1/2):


#### 1.2 同步模式配置界面
=== 同步模式配置 ===
�� 源文件选择（包含完整学号和姓名信息的文件）：
[文件列表显示]
请选择源文件编号（用逗号分隔）:
�� 目标文件选择（需要更新学生姓名的文件）：
[文件列表显示]
请选择目标文件编号（用逗号分隔）:
�� 关联字段配置：
当前关联字段: 学号
是否修改关联字段？(y/n，默认n):
�� 同步策略配置：
只更新空的学生姓名记录
更新所有记录（覆盖现有姓名）
自定义更新条件
请选择同步策略 (1/2/3，默认1):
�� 默认值配置：
未找到匹配学号时的处理方式：
使用默认值（如"未知学生"）
保持原状（不修改）
标记为特殊值（如"未找到"）
请选择处理方式 (1/2/3，默认1):


### 2. 核心算法设计

#### 2.1 同步处理流程
```python
def sync_student_names(source_files: List[str], target_files: List[str], 
                      link_field: str, name_field: str, sync_strategy: str, 
                      default_value: str) -> Dict:
    """
    学生姓名同步处理
    
    Args:
        source_files: 源文件列表
        target_files: 目标文件列表
        link_field: 关联字段名
        name_field: 学生姓名字段名
        sync_strategy: 同步策略
        default_value: 默认值
        
    Returns:
        同步结果统计
    """
    # 1. 从源文件构建学号-姓名映射
    # 2. 读取目标文件
    # 3. 根据同步策略更新学生姓名
    # 4. 保存更新后的目标文件
    # 5. 返回统计信息
```

#### 2.2 映射构建算法
- 支持多个源文件合并映射
- 处理重复学号冲突
- 支持不同字段名称的自动识别
- 提供映射质量检查

#### 2.3 同步更新算法
- 根据同步策略确定更新范围
- 支持批量文件处理
- 提供详细的更新日志
- 支持回滚操作（可选）

### 3. 输出要求

#### 3.1 同步统计报告


### 2. 核心算法设计

#### 2.1 同步处理流程
```python
def sync_student_names(source_files: List[str], target_files: List[str], 
                      link_field: str, name_field: str, sync_strategy: str, 
                      default_value: str) -> Dict:
    """
    学生姓名同步处理
    
    Args:
        source_files: 源文件列表
        target_files: 目标文件列表
        link_field: 关联字段名
        name_field: 学生姓名字段名
        sync_strategy: 同步策略
        default_value: 默认值
        
    Returns:
        同步结果统计
    """
    # 1. 从源文件构建学号-姓名映射
    # 2. 读取目标文件
    # 3. 根据同步策略更新学生姓名
    # 4. 保存更新后的目标文件
    # 5. 返回统计信息
```

#### 2.2 映射构建算法
- 支持多个源文件合并映射
- 处理重复学号冲突
- 支持不同字段名称的自动识别
- 提供映射质量检查

#### 2.3 同步更新算法
- 根据同步策略确定更新范围
- 支持批量文件处理
- 提供详细的更新日志
- 支持回滚操作（可选）

### 3. 输出要求

#### 3.1 同步统计报告

=== 同步处理完成 ===
�� 同步统计信息：
源文件数量: 2 个
目标文件数量: 3 个
映射关系数量: 150 个学号
成功更新记录: 120 个
使用默认值记录: 5 个
保持原状记录: 25 个
同步成功率: 83.3%
�� 详细文件处理报告：
文件1: 成绩表.xlsx
更新记录: 45 个
使用默认值: 2 个
保持原状: 8 个
文件2: 课程表.xlsx
更新记录: 75 个
使用默认值: 3 个
保持原状: 17 个


#### 3.2 输出文件
- 更新后的目标Excel文件
- 同步处理报告Excel文件（包含详细统计）
- 映射关系备份文件（可选）

## 兼容性要求

### 1. 与现有功能集成
- 保持现有合并功能的完整性
- 在现有类中添加新的同步方法
- 共享现有的文件读取和字段分析功能
- 保持用户界面风格的一致性

### 2. 配置选项
- 同步功能作为可选模块
- 用户可选择启用或禁用
- 支持配置文件的保存和加载
- 提供默认配置选项

## 错误处理要求

### 1. 文件处理错误
- 源文件读取失败的处理
- 目标文件写入失败的处理
- 文件格式不兼容的处理
- 权限不足的处理

### 2. 数据一致性检查
- 学号格式不一致的检测
- 重复学号的检测和报告
- 字段缺失的检测
- 数据类型的验证

### 3. 同步冲突处理
- 学号不匹配的处理
- 字段名称不匹配的处理
- 数据格式不一致的处理
- 提供冲突解决建议

## 性能要求

### 1. 处理效率
- 支持大量文件的批量处理
- 优化内存使用，避免一次性加载所有数据
- 提供处理进度显示
- 支持中断和恢复功能

### 2. 用户体验
- 清晰的操作提示
- 详细的进度反馈
- 友好的错误提示
- 完整的操作日志

## 测试要求

### 1. 测试场景
- 单文件同步测试
- 多文件批量同步测试
- 不同字段名称的兼容性测试
- 冲突情况的处理测试
- 错误情况的恢复测试

### 2. 边界情况
- 空文件处理
- 超大文件处理
- 特殊字符处理
- 编码问题处理

## 交付要求

### 1. 代码实现
- 在现有ExcelProcessor类中添加同步方法
- 保持现有接口的兼容性
- 提供清晰的配置选项
- 添加完整的错误处理

### 2. 文档更新
- 更新README文档
- 提供同步功能的使用说明
- 添加配置选项说明
- 提供故障排除指南

### 3. 测试验证
- 提供测试用例
- 验证各种场景的功能
- 确保与现有功能的兼容性
- 性能测试和优化

## 注意事项

1. **数据安全**：同步操作会修改现有文件，需要提供备份机制
2. **用户确认**：重要操作需要用户确认
3. **进度反馈**：长时间操作需要提供进度显示
4. **错误恢复**：提供错误发生时的恢复机制
5. **日志记录**：记录所有操作日志，便于问题排查

请基于以上需求开发相应的同步功能模块，确保与现有代码的无缝集成，并提供完整的用户界面和错误处理机制。