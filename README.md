# Excel 文件处理工具 v2.1

一个功能强大的 Excel 文件处理工具，支持多文件数据合并、字段选择、去重处理和学生姓名补充功能。

## 功能特性

### 🎯 核心功能

-   **多文件数据合并**：支持同时处理多个 Excel 文件
-   **智能字段选择**：按出现频率排序，支持分页浏览
-   **数据去重**：支持基于多个字段的去重处理
-   **学生姓名补充**：自动根据学号匹配补充学生姓名

### 👤 学生姓名补充功能（新增）

-   **智能分析**：自动识别包含学号但缺少学生姓名的文件
-   **映射构建**：从包含完整信息的文件中构建学号-姓名映射
-   **自动补充**：为缺少学生姓名的记录自动补充
-   **默认值处理**：未找到匹配时使用可配置的默认值
-   **统计报告**：提供详细的补充统计信息

## 安装要求

```bash
pip install pandas openpyxl
```

## 使用方法

### 基本使用

```bash
python excel_processor.py
```

### 功能测试

```bash
# 基本功能测试
python test_student_name_supplement.py

# 全面功能测试
python test_comprehensive.py
```

## 使用流程

### 1. 文件选择

-   输入包含 Excel 文件的文件夹路径
-   选择要处理的文件（支持单选、多选或全选）

### 2. 字段分析

-   系统自动分析所有文件的字段结构
-   显示每个文件包含的字段数量

### 3. 字段选择

-   按出现频率排序显示所有可用字段
-   支持分页浏览和搜索
-   选择需要导入的字段

### 4. 学生姓名补充配置（可选）

-   系统自动检测是否需要学生姓名补充
-   显示分析结果（包含学号的文件、缺少姓名的文件等）
-   配置默认学生姓名值

### 5. 去重配置（可选）

-   选择是否启用去重功能
-   选择去重字段（支持单字段、多字段或全部字段）

### 6. 输出设置

-   设置输出文件名和路径

### 7. 数据处理

-   自动合并所有文件数据
-   执行学生姓名补充（如果启用）
-   执行去重处理（如果启用）

### 8. 结果导出

-   导出到 Excel 文件，包含多个工作表：
    -   **合并数据**：处理后的主要数据
    -   **处理统计**：详细的处理统计信息
    -   **字段信息**：字段类型和空值统计

## 学生姓名补充功能详解

### 适用场景

-   某些 Excel 文件包含"学号"字段但缺少"学生姓名"字段
-   需要从其他文件中根据学号匹配获取学生姓名
-   希望统一管理学生信息

### 工作原理

1. **文件分析**：识别文件类型

    - 包含学号和姓名的文件（映射源）
    - 包含学号但缺少姓名的文件（需要补充）
    - 不包含学号的文件（无关文件）

2. **映射构建**：从映射源文件构建学号-姓名对应关系

    - 支持多个映射源文件
    - 自动处理重复学号（优先使用第一个匹配）

3. **数据补充**：为需要补充的文件添加学生姓名
    - 根据学号查找对应的学生姓名
    - 找不到匹配时使用默认值
    - 自动创建学生姓名字段（如果不存在）

### 配置选项

-   **启用/禁用**：用户可选择是否启用此功能
-   **默认姓名**：设置未找到匹配时使用的默认值
-   **自动添加字段**：自动将学生姓名字段添加到选择列表

### 统计信息

-   成功匹配的记录数量
-   使用默认值的记录数量
-   补充成功率百分比

## 输出文件说明

### 合并数据工作表

包含所有处理后的数据记录

### 处理统计工作表

| 统计项目             | 说明                     |
| -------------------- | ------------------------ |
| 总记录数             | 最终输出的记录总数       |
| 处理文件数           | 参与处理的文件数量       |
| 选择字段数           | 用户选择的字段数量       |
| 是否去重             | 是否启用了去重功能       |
| 去重字段数           | 去重使用的字段数量       |
| 删除重复记录数       | 去重删除的记录数量       |
| 是否启用学生姓名补充 | 是否启用了学生姓名补充   |
| 成功匹配学生姓名数   | 成功匹配的学生姓名数量   |
| 使用默认学生姓名数   | 使用默认值的学生姓名数量 |
| 学生姓名补充成功率   | 补充成功的百分比         |
| 处理时间             | 处理完成的时间戳         |

### 字段信息工作表

| 字段名称   | 字段类型 | 非空值数量 | 空值数量   |
| ---------- | -------- | ---------- | ---------- |
| 各字段信息 | 数据类型 | 有效数据量 | 缺失数据量 |

## 示例

### 输入文件

-   `学生信息.xlsx`：包含学号和学生姓名
-   `成绩记录.xlsx`：包含学号但缺少学生姓名
-   `课程记录.xlsx`：包含学号但缺少学生姓名

### 处理结果

-   自动从`学生信息.xlsx`构建学号-姓名映射
-   为`成绩记录.xlsx`和`课程记录.xlsx`补充学生姓名
-   未找到匹配的学号使用默认值"未知学生"

## 注意事项

1. **文件格式**：支持.xlsx 和.xls 格式
2. **字段名称**：学号字段必须命名为"学号"，学生姓名字段必须命名为"学生姓名"
3. **数据一致性**：确保学号格式一致，避免匹配失败
4. **文件权限**：确保有读取源文件和写入目标文件的权限
5. **内存使用**：处理大量文件时注意内存使用情况

## 版本历史

### v2.1 (当前版本)

-   ✅ 新增学生姓名补充功能
-   ✅ 智能文件分析和映射构建
-   ✅ 详细的补充统计信息
-   ✅ 与现有功能的完美集成

### v2.0

-   ✅ 多文件数据合并
-   ✅ 智能字段选择
-   ✅ 数据去重功能
-   ✅ 多工作表输出

## 技术支持

如有问题或建议，请查看测试文件或联系开发者。
